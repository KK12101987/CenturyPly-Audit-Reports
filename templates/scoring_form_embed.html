
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Scoring Form Embed - CenturyPly</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <style> body{background:#f6f7f9;font-family:Inter,system-ui, -apple-system, "Segoe UI", Roboto, Arial;} .required{color:#b91c1c;} </style>
</head>
<body>
<div class="container my-3">
  <form id="audit-form" class="card p-3 shadow-sm bg-white">
    <div class="row g-2 mb-3">
      <div class="col-md-4"><label class="form-label">Relationship Manager</label><input id="rmName" name="rm_name" class="form-control" placeholder="RM Name"></div>
      <div class="col-md-4"><label class="form-label">Team Name</label><input id="teamName" name="team_name" class="form-control" placeholder="Team"></div>
      <div class="col-md-4"><label class="form-label">RM's Captain</label><input id="rmCaptain" name="rm_captain" class="form-control" placeholder="Captain"></div>
    </div>
    <div class="row g-2 mb-3">
      <div class="col-md-3"><label class="form-label">Date of Audit</label><input id="dateOfAudit" name="date_of_audit" type="date" class="form-control"></div>
      <div class="col-md-3"><label class="form-label">AID Mobile Number</label><input id="aidMobile" name="aid_mobile" class="form-control" placeholder="Mobile"></div>
      <div class="col-md-3"><label class="form-label">Call Date</label><input id="callDate" name="call_date" type="date" class="form-control"></div>
      <div class="col-md-3"><label class="form-label">Evaluator (QA)</label><input id="captainName" name="evaluator" class="form-control" placeholder="QA Name"></div>
    </div>

    <div class="accordion" id="scoringAccordion">
      <!-- Section A -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingA"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseA">Section A — Call Process</button></h2>
        <div id="collapseA" class="accordion-collapse collapse show" data-bs-parent="#scoringAccordion">
          <div class="accordion-body">
            <div class="row g-2">
              <div class="col-md-6 mb-2"><label class="form-label">Introduction <span class="required">*</span></label><input id="Introduction" name="Introduction" class="form-control" placeholder="Score (0-10)"></div>
              <div class="col-md-6 mb-2"><label class="form-label">Project Registration</label><input id="ProjectRegistration" name="Project Registration" class="form-control" placeholder="Score or N/A"></div>
              <div class="col-md-6 mb-2"><label class="form-label">Product & Pricing requirement</label><input id="ProductPricing" name="Product & Pricing requirement" class="form-control" placeholder="Score or N/A"></div>
              <div class="col-md-6 mb-2"><label class="form-label">Product Feedback</label><input id="ProductFeedback" name="Product FeedBack" class="form-control" placeholder="Score or N/A"></div>
              <div class="col-md-6 mb-2"><label class="form-label">Cross & upsell of product</label><input id="CrossUpsell" name="Cross & upsell of product" class="form-control" placeholder="Score or N/A"></div>
              <div class="col-md-6 mb-2"><label class="form-label">Marketing Benefit</label><input id="MarketingBenefit" name="Marketing Benefit" class="form-control" placeholder="Score or N/A"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Section B -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingB"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseB">Section B — Compliance</button></h2>
        <div id="collapseB" class="accordion-collapse collapse" data-bs-parent="#scoringAccordion">
          <div class="accordion-body">
            <div class="row g-2">
              <div class="col-md-6 mb-2"><label class="form-label">Redemption (Critical)</label><input id="Redemption" name="Redem tion" class="form-control" placeholder="Score or 0 if missing"></div>
              <div class="col-md-6 mb-2"><label class="form-label">Call Closure</label><input id="CallClosure" name="Call Closure" class="form-control" placeholder="Score or N/A"></div>
              <div class="col-md-6 mb-2"><label class="form-label">GTM Adherence (Critical)</label><input id="GTMAdherence" name="GTM Adherence" class="form-control" placeholder="Score or 0 if missing"></div>
              <div class="col-md-6 mb-2"><label class="form-label">CRM Update (Critical)</label><input id="CRMUpdate" name="CRM Update" class="form-control" placeholder="Score or 0 if missing"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Section C -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingC"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseC">Section C — Soft Skills & Overall</button></h2>
        <div id="collapseC" class="accordion-collapse collapse" data-bs-parent="#scoringAccordion">
          <div class="accordion-body">
            <div class="row g-2">
              <div class="col-md-4 mb-2"><label class="form-label">Softskill</label><input id="Softskill" name="Softskill" class="form-control" placeholder="Score or N/A"></div>
              <div class="col-md-4 mb-2"><label class="form-label">Total Score</label><input id="TotalScore" name="Total Score" class="form-control" placeholder="Calculated or entered"></div>
              <div class="col-md-4 mb-2"><label class="form-label">Total</label><input id="Total" name="Total" class="form-control" placeholder="Max possible"></div>
              <div class="col-md-4 mb-2"><label class="form-label">%age</label><input id="Perc" name="%age" class="form-control" placeholder="Percentage"></div>
              <div class="col-12 mb-2"><label class="form-label">Audit Observation</label><textarea id="AuditObservation" name="Audit Observation" class="form-control" rows="3"></textarea></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row mt-3">
      <div class="col-md-4"><label class="form-label">QA Status</label><select id="qaStatus" class="form-select"><option value="">-- Select Status --</option><option value="No Calls">No Calls</option><option value="No Auditable Call">No Auditable Call</option><option value="Picnic">Picnic</option><option value="HO">HO</option><option value="Absent">Absent</option></select></div>
      <div class="col-md-8 text-end align-self-end"><button type="button" id="saveBtn" class="btn btn-accent">Save</button></div>
    </div>
  </form>
</div>

<script>
// Save handler (posts to /save_status)
document.getElementById('saveBtn').addEventListener('click', async function(){
  const payload = {
    rm_name: document.getElementById('rmName').value || 'Unknown RM',
    evaluator: document.getElementById('captainName').value || 'QA_User',
    team_name: document.getElementById('teamName').value || '',
    rm_captain: document.getElementById('rmCaptain').value || '',
    date_of_audit: document.getElementById('dateOfAudit').value || '',
    aid_mobile: document.getElementById('aidMobile').value || '',
    call_date: document.getElementById('callDate').value || '',
    "Introduction": document.getElementById('Introduction').value || '',
    "Project Registration": document.getElementById('ProjectRegistration').value || '',
    "Product & Pricing requirement": document.getElementById('ProductPricing').value || '',
    "Product FeedBack": document.getElementById('ProductFeedback').value || '',
    "Cross & upsell of product": document.getElementById('CrossUpsell').value || '',
    "Marketing Benefit": document.getElementById('MarketingBenefit').value || '',
    "Redem tion": document.getElementById('Redemption').value || '',
    "Call Closure": document.getElementById('CallClosure').value || '',
    "GTM Adherence": document.getElementById('GTMAdherence').value || '',
    "CRM Update": document.getElementById('CRMUpdate') ? document.getElementById('CRMUpdate').value : '',
    "Softskill": document.getElementById('Softskill').value || '',
    "Total Score": document.getElementById('TotalScore').value || '',
    "Total": document.getElementById('Total').value || '',
    "%age": document.getElementById('Perc').value || '',
    "Audit Observation": document.getElementById('AuditObservation').value || '',
    status: document.getElementById('qaStatus').value || ''
  };
  try {
    const res = await fetch('/save_status', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
    const j = await res.json();
    if(j.success) alert(j.message); else alert(j.message || 'Save failed');
  } catch(err) {
    alert('Server error: ' + err);
  }
});
</script>

</body>
</html>
